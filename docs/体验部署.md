# 体验部署（内测）

目标：让测试同学“解压即可用”，优先体验与覆盖率，不做鉴权、不做隐私脱敏（后续再加开关）。

## OS 原生安装器（推荐）

为降低门槛，项目已提供“原生安装器”构建方式（适合对外分发/正式安装）：

- macOS：
  - DMG：拖拽 `.app` 到 `/Applications`（最常见分发形态）
  - PKG：双击安装到 `/Applications`（更像传统“安装器”）
- Windows：
  - EXE 安装器：基于 Inno Setup（安装到 Program Files，创建开始菜单快捷方式）

安装器模式下，运行数据不会写入安装目录（避免权限问题），而是落在：

- macOS：`~/Library/Application Support/Crypto-Trace-Inspector/`
- Windows：`%LOCALAPPDATA%\\Crypto-Trace-Inspector\\`

其中包含：

- `data/inspector.db`：SQLite 数据库
- `data/evidence/`：证据快照目录
- `logs/`：运行日志（排障用）

### 安装器构建（开发/发版）

- macOS（在 macOS 上执行）：

```bash
VERSION=0.1.0 bash scripts/package_macos_installer.sh
```

产物输出到：

- `dist/installers/macos/*.dmg`
- `dist/installers/macos/*.pkg`

- Windows（在 Windows 上执行，需安装 Inno Setup）：

```powershell
# 1) 构建 bundle（exe + rules）
bash scripts/package_bundle.sh

# 2) 编译安装器（Inno Setup）
"C:\\Program Files (x86)\\Inno Setup 6\\ISCC.exe" installer\\windows\\crypto-trace-inspector.iss
```

产物输出到：

- `dist\\installers\\windows\\*.exe`

## 目录结构（解压后）

- `inspector` / `inspector.exe`：命令行工具（包含 Web UI/API）
- `inspector-desktop` / `inspector-desktop.exe`：桌面启动器（推荐，自动打开 UI）
- `rules/`：规则文件目录（钱包/交易所）
- `data/`：运行时数据目录（首次运行自动生成）
  - `inspector.db`：SQLite 数据库
  - `evidence/`：证据快照文件

## 启动 Web 控制台

macOS：

```bash
./start.sh
```

Windows（PowerShell）：

```powershell
.\start.ps1
```

启动器会自动打开 UI：

- macOS：默认使用内嵌 WebView（更像客户端）
- Windows：默认打开系统浏览器

如未自动打开，也可手动访问：

- `http://127.0.0.1:8787`

## 一键扫描

进入 Web 控制台后：

- 左侧导航进入 `03 数据采集`
- 点击 `[开始采集]`

扫描完成后会自动生成：

- 案件（case）
- 证据快照（artifacts）
- 命中（hits）
- 报告（reports）

## 移动端采集依赖（可选）

如果希望采集 Android/iOS：

- Android：需要 `adb`（已开启 USB 调试并授权）
- iOS：需要 `libimobiledevice` 工具链：
  - `idevice_id` / `idevicepair` / `ideviceinfo` / `ideviceinstaller` / `idevicebackup2`

如果工具不存在，系统会在报告与前置条件检查中提示 `not found`，不影响主机侧采集。
