# 开源数字取证项目深度分析与整合建议

> **目的**：系统梳理主流开源数字取证项目的核心能力，对比 crypto-inspector 现有实现，找出差距与可借鉴点，制定打造行业顶级产品的整合路线。

---

## 一、项目全景对比

```
┌──────────────────┬───────────────┬───────────────┬───────────────┬───────────────┬──────────────────┐
│     能力维度      │ FORESHADOW   │ Autopsy + TSK │   BlockSci    │     DFF       │ crypto-inspector │
│                  │ (内存取证)     │ (磁盘取证)     │ (链上分析)     │ (通用取证)     │  (本项目)         │
├──────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────────┤
│ 硬件钱包内存痕迹  │ ★★★★★        │ ✗             │ ✗             │ 可扩展         │ ✗ 尚未实现        │
│ 软件钱包安装检测  │ ✗             │ ★★★★         │ ✗             │ ★★★           │ ★★★★ 已实现      │
│ 浏览器扩展检测    │ ✗             │ ★★★          │ ✗             │ ★★            │ ★★★★★ 已实现     │
│ 浏览器历史分析    │ ✗             │ ★★★★★        │ ✗             │ ★★★           │ ★★★★ 已实现      │
│ 交易所域名匹配    │ ✗             │ ✗（需定制）    │ ✗             │ ✗             │ ★★★★★ 已实现     │
│ 链上余额查询      │ ✗             │ ✗             │ ★★★★         │ ✗             │ ★★★ 已实现       │
│ 链上交易追溯      │ ✗             │ ✗             │ ★★★★★        │ ✗             │ ✗ 尚未实现        │
│ 移动端设备扫描    │ ✗             │ ★★★（镜像级）  │ ✗             │ ★★            │ ★★★ 已实现       │
│ 磁盘镜像分析      │ ✗             │ ★★★★★        │ ✗             │ ★★★★          │ ✗ 不适用          │
│ 内存转储分析      │ ★★★★★        │ ✗             │ ✗             │ ★★★           │ ✗ 尚未实现        │
│ 证据链完整性      │ ★★            │ ★★★           │ ✗             │ ★★★           │ ★★★★★ 已实现     │
│ 取证报告生成      │ ✗             │ ★★★★         │ ✗             │ ★★★           │ ★★★★ 已实现      │
│ 司法导出包        │ ✗             │ ★★★★         │ ✗             │ ★★★           │ ★★★★ 已实现      │
│ Web UI           │ ✗             │ ★★★★★ (Java) │ Jupyter       │ ★★★ (Qt)     │ ★★★ 已实现       │
│ 一键操作          │ ✗             │ ★★★          │ ✗             │ ★★            │ ★★★★ 已实现      │
└──────────────────┴───────────────┴───────────────┴───────────────┴───────────────┴──────────────────┘
```

---

## 二、逐项目深度分析

### 2.1 FORESHADOW — 硬件钱包内存取证

| 属性 | 内容 |
|------|------|
| **项目地址** | https://github.com/BiTLab-BaggiliTruthLab/FORESHADOW |
| **技术栈** | Python，Volatility Framework 插件 |
| **开发团队** | 纽黑文大学 BiTLab 实验室 (Thomas et al., 2020) |
| **维护状态** | 学术项目，低维护频率 |
| **许可证** | 开源 |

#### 核心能力

FORESHADOW 是**唯一**一个专门针对硬件加密钱包的内存取证工具，通过分析 Windows 内存转储（memory dump），可提取：

1. **交易历史**：Ledger Live / Trezor Wallet 客户端中的完整交易记录
2. **扩展公钥（xPub）**：这是最关键的产物——从 xPub 可以推导出 HD 钱包的**所有历史和未来地址**，实现交易去匿名化
3. **密码/口令**：用户输入的钱包口令（Trezor 应用密码已被证明可恢复）
4. **设备唯一标识符**：把物理硬件钱包与特定电脑关联起来
5. **API 请求记录**：客户端与后端的通信痕迹

#### 技术原理

```
内存转储 (Raw Memory Dump)
    ↓
Volatility Framework 加载
    ↓
YARA 规则扫描 → 定位 Ledger/Trezor 数据结构
    ↓
反序列化为 Python 对象
    ↓
可视化报告输出
```

关键发现：部分痕迹在应用关闭**几分钟内**就会被系统覆写，强调时效性。

#### 对 crypto-inspector 的价值评估

| 维度 | 评分 | 分析 |
|------|------|------|
| **功能互补性** | ⭐⭐⭐⭐⭐ | crypto-inspector 完全没有内存取证能力，这是最大补充 |
| **技术可行性** | ⭐⭐⭐ | 需要嵌入 Python/Volatility 运行时，或用 Go 重写核心逻辑 |
| **实战价值** | ⭐⭐⭐⭐⭐ | 硬件钱包是高净值用户首选，xPub 提取可直接关联资产 |
| **整合难度** | ⭐⭐⭐⭐ (高) | 内存转储的获取需要系统权限，跨平台兼容（目前仅 Windows） |

#### 可整合功能清单

- [ ] **P0**：支持加载外部 `.raw` / `.vmem` 内存转储文件
- [ ] **P0**：实现 Ledger Live / Trezor Wallet 的 YARA 签名扫描
- [ ] **P1**：扩展公钥（xPub）提取与地址推导
- [ ] **P1**：设备标识符提取（关联物理钱包与主机）
- [ ] **P2**：API 请求痕迹还原
- [ ] **P2**：macOS 内存取证适配（当前仅 Windows）

---

### 2.2 Autopsy + The Sleuth Kit — 磁盘取证标杆

| 属性 | 内容 |
|------|------|
| **项目地址** | https://github.com/sleuthkit/autopsy + https://github.com/sleuthkit/sleuthkit |
| **技术栈** | Java (Autopsy GUI) + C/C++ (TSK 底层库) |
| **维护状态** | ★★★★★ 活跃维护，已发布 26 个版本 |
| **贡献者** | 63 人 |
| **行业地位** | 全球执法机构广泛使用的行业标准工具 |

#### 核心能力

Autopsy 是磁盘级取证的"瑞士军刀"，其对 crypto-inspector 最有借鉴价值的能力包括：

**1. 浏览器取证（Browser Forensics）— 远超 crypto-inspector 现有能力**
- 合并展示 Chrome/Firefox/IE/Edge/Safari 全部浏览数据
- **已删除历史恢复**（从 SQLite WAL/未分配空间中恢复）
- Cookie 分析（可检测交易所登录态）
- 下载记录分析
- 书签分析
- 搜索查询提取（如搜索过 "Bitcoin wallet" "OKX 注册" 等）
- **缓存文件分析**（网页快照、图片缓存）

**2. 文件系统深度分析**
- 已删除文件恢复
- 文件签名匹配（不靠扩展名，靠 magic bytes 识别文件类型）
- **时间线分析**（Timeline）：横跨文件系统、注册表、浏览器的全局时间线
- 文件哈希集合匹配（NSRL / 自定义黑白名单）
- 关键词搜索（全盘搜索钱包相关关键词）

**3. 加密货币专项（通过插件）**
- FEA 插件：Bitcoin 钱包地址和私钥搜索/校验
- Atomic Wallet 解析插件
- 钱包文件识别（`~/.bitcoin/`、`~/.ethereum/`、Ledger Live 数据目录等）
- 加密容器检测（TrueCrypt/VeraCrypt 容器等常见隐藏手段）

**4. 取证报告体系**
- HTML/PDF 报告生成
- 证据标签（Tag）系统
- 案件管理（多案件/多数据源）

#### 对 crypto-inspector 的价值评估

| 维度 | 评分 | 分析 |
|------|------|------|
| **功能互补性** | ⭐⭐⭐⭐ | 浏览器深度取证、已删除数据恢复、时间线分析是重要补充 |
| **设计借鉴** | ⭐⭐⭐⭐⭐ | UI 设计、案件管理、证据标签系统值得全面学习 |
| **技术可行性** | ⭐⭐⭐⭐ | 关键思路（Cookie 分析、关键词搜索）可用 Go 实现 |
| **行业对标** | ⭐⭐⭐⭐⭐ | 这是"行业标准"，crypto-inspector 的目标应该是"聚焦数字币的 Autopsy" |

#### 可整合功能清单

- [ ] **P0**：浏览器 Cookie 分析（检测交易所登录态/会话）
- [ ] **P0**：搜索引擎查询提取（"bitcoin" "eth 交易" 等关键词）
- [ ] **P0**：浏览器下载记录分析（钱包安装包/密钥文件下载）
- [ ] **P1**：已删除浏览历史恢复（SQLite WAL 解析）
- [ ] **P1**：全盘关键词搜索（钱包助记词、私钥、地址格式）
- [ ] **P1**：时间线可视化（证据事件时间轴）
- [ ] **P1**：证据标签/书签系统（调查人员标记功能）
- [ ] **P2**：文件签名匹配（钱包数据文件的 magic bytes 识别）
- [ ] **P2**：磁盘镜像导入支持（E01/dd/Raw 格式）
- [ ] **P2**：加密容器检测

---

### 2.3 BlockSci — 区块链深度分析

| 属性 | 内容 |
|------|------|
| **项目地址** | https://github.com/citp/BlockSci |
| **技术栈** | C++ 核心 + Python 绑定 + Jupyter Notebook |
| **维护状态** | ⚠️ **已停止维护**（2020 年 11 月起不再活跃开发） |
| **论文** | USENIX Security 2020 发表 |
| **性能** | 遍历 Bitcoin 所有交易输入输出仅需 1 秒（r5.4xlarge 机器上） |

#### 核心能力

BlockSci 是**纯链上分析**工具，不做设备端检测。其核心价值在于：

1. **高性能区块链遍历**：利用 append-only 数据特性做定制内存数据库，远超传统 SQL 数据库
2. **交易图谱分析**：追踪资金流向，识别关联交易
3. **地址聚类**：通过启发式算法将多个地址归属到同一实体
4. **多链支持**：Bitcoin、Bitcoin Cash、Litecoin 等
5. **编程化查询**：Python API + Jupyter 交互式分析

#### 对 crypto-inspector 的价值评估

| 维度 | 评分 | 分析 |
|------|------|------|
| **功能互补性** | ⭐⭐⭐ | 链上追溯能力有价值，但项目已停止维护 |
| **思路借鉴** | ⭐⭐⭐⭐ | "从设备证据中提取地址 → 链上追溯"的联动思路有价值 |
| **实施风险** | ⭐⭐⭐⭐⭐ (高风险) | C++ 代码库不再更新，可能与新版区块链格式不兼容 |
| **替代方案** | 可用公开 API（Blockchair/Etherscan/Blockstream）替代 |

#### 可整合思路（不直接集成 BlockSci，而是借鉴其理念）

- [ ] **P1**：从设备证据中提取钱包地址 → 自动查询链上余额（已部分实现）
- [ ] **P1**：交易追溯可视化（调用 Blockchair/Etherscan API 展示交易图）
- [ ] **P2**：地址聚类分析（多地址归属同一实体）
- [ ] **P2**：资金流向分析（上下游交易可视化）
- [ ] **P3**：接入 Breadcrumbs.app / Metasleuth 等第三方链上分析平台

---

### 2.4 DFF (Digital Forensics Framework) — 模块化取证框架

| 属性 | 内容 |
|------|------|
| **项目地址** | http://www.digital-forensic.org/ |
| **技术栈** | C++ + Python |
| **维护状态** | ⚠️ 长期未更新，社区活跃度低 |
| **设计理念** | 模块化、可扩展的取证框架 |

#### 核心能力

DFF 的主要价值在于其**架构理念**而非具体实现：

1. **模块化架构**：所有取证功能以插件形式加载
2. **虚拟文件系统（VFS）**：统一抽象各种数据源
3. **多源输入**：磁盘镜像、内存转储、网络流量
4. **批处理引擎**：自动化取证流水线

#### 对 crypto-inspector 的价值评估

| 维度 | 评分 | 分析 |
|------|------|------|
| **代码可用性** | ⭐ | 项目过旧，代码不建议直接使用 |
| **架构借鉴** | ⭐⭐⭐ | 模块化插件系统、取证流水线思想有参考价值 |
| **实施优先级** | 低 | 理念性参考，不做具体整合 |

---

## 三、OSINT 区块链分析资源整合

[awesome_osint_blockchain_analysis](https://github.com/aaarghhh/awesome_osint_blockchain_analysis) 提供了丰富的链上 OSINT 资源，按链分类如下：

### 可直接整合的 API 数据源

| 链 | 区块链浏览器 API | 黑名单/风险数据库 | 地址正则 |
|----|-----------------|-------------------|----------|
| **BTC** | Blockstream API ✅已用, Blockchain.info, Blockchair | CryptoBlacklist, Chainabuse, Bitcoinabuse, Ransomwhere | `1[a-km-zA-HJ-NP-Z1-9]{25,34}` / `bc1[...]{39,59}` |
| **ETH** | Etherscan, Blockscout | Chainabuse | `0x[0-9a-fA-F]{40}` |
| **SOL** | Solscan, SolanaFM | — | Base58, 32-44 字符 |
| **XMR** | XMR探区浏览器 | — | `4[0-9AB][0-9a-zA-Z]{93}` |
| **TRX** | Tronscan | — | `T[a-zA-Z0-9]{33}` |

### 高价值风险情报源

| 数据源 | 类型 | 可用于 |
|--------|------|--------|
| **Chainabuse** | 诈骗/恶意地址举报 | 命中地址风险标签 |
| **Bitcoinabuse** | BTC 恶意地址 | 命中地址风险标签 |
| **Ransomwhere** | 勒索软件地址 | 命中地址定性 |
| **CryptoBlacklist** | 黑名单地址集 | 命中地址风险标签 |
| **SPLcenter** | 已知恶意加密地址 | 补充情报 |
| **Arkham Intelligence** | 链上实体归属 | 地址去匿名化 |

---

## 四、crypto-inspector 现有优势与差距

### ✅ 已有优势（超越多数开源工具的地方）

| 优势 | 说明 |
|------|------|
| **一键化操作** | 开箱即用的 CLI + Desktop + Web，无需配置磁盘镜像 |
| **证据链完整性** | record_hash + chain_hash，比 Autopsy 更严格 |
| **聚焦领域** | 专为数字币取证设计，规则引擎针对性强 |
| **链上余额实查** | 已实现 EVM/ERC20/BTC 余额查询，FORESHADOW/Autopsy 均无此能力 |
| **司法导出** | ZIP + PDF 取证报告，可直接用于案件流转 |
| **多平台** | 同时支持 macOS/Windows + Android/iOS |

### ❌ 关键差距

| 差距 | 重要性 | 对标项目 |
|------|--------|----------|
| 无内存取证能力 | ⭐⭐⭐⭐⭐ | FORESHADOW |
| 无已删除数据恢复 | ⭐⭐⭐⭐ | Autopsy |
| 无 Cookie/会话分析 | ⭐⭐⭐⭐ | Autopsy |
| 无搜索查询提取 | ⭐⭐⭐ | Autopsy |
| 无链上交易追溯 | ⭐⭐⭐ | BlockSci |
| 无地址风险情报 | ⭐⭐⭐⭐ | awesome OSINT |
| 无时间线可视化 | ⭐⭐⭐ | Autopsy |
| 无钱包文件深度解析 | ⭐⭐⭐⭐ | FORESHADOW |
| 无地址正则全文搜索 | ⭐⭐⭐⭐ | Autopsy/OSINT |
| 无下载记录分析 | ⭐⭐⭐ | Autopsy |

---

## 五、打造行业顶级产品的整合路线

### 产品定位升级

```
当前定位：数字币痕迹检测工具
    ↓ 升级为 ↓
目标定位：一站式数字货币取证分析平台
         "聚焦数字币领域的 Autopsy + 内存取证 + 链上追溯"
```

### 分阶段实施计划

#### 阶段一：补齐高价值缺失能力（4-6 周）

**目标：让产品从"检测工具"升级为"取证工具"**

| 序号 | 功能 | 来源借鉴 | 实现方案 | 优先级 |
|------|------|----------|----------|--------|
| 1 | 浏览器 Cookie 分析 | Autopsy | 扩展 `host/scanner.go`，解析 Chrome/Firefox/Safari Cookies.sqlite，匹配交易所域名 | P0 |
| 2 | 搜索引擎查询提取 | Autopsy | 从浏览历史中提取搜索引擎关键词（Google/Baidu/Bing 的 q= 参数） | P0 |
| 3 | 浏览器下载记录 | Autopsy | 解析 Chrome `History` 数据库的 `downloads` 表 | P0 |
| 4 | 钱包地址正则全文搜索 | OSINT 资源 | 新增 `address_scanner` 模块：BTC/ETH/TRX/SOL 地址正则匹配浏览器数据 | P0 |
| 5 | 地址风险情报查询 | OSINT 资源 | 接入 Chainabuse/Bitcoinabuse API，对命中地址做风险标签 | P1 |
| 6 | 时间线视图 | Autopsy | Web UI 实现证据时间线可视化 | P1 |

#### 阶段二：内存取证能力引入（6-8 周）

**目标：覆盖 FORESHADOW 的核心能力，成为全球首个整合内存取证的一键化工具**

| 序号 | 功能 | 来源借鉴 | 实现方案 | 优先级 |
|------|------|----------|----------|--------|
| 7 | 内存转储文件导入 | FORESHADOW | 支持加载 `.raw`/`.vmem`/`.dmp` 内存转储 | P0 |
| 8 | 硬件钱包客户端签名扫描 | FORESHADOW | 用 Go 实现 YARA 规则扫描（`go-yara` 库），识别 Ledger/Trezor 数据结构 | P0 |
| 9 | xPub / 公钥提取 | FORESHADOW | 从内存中提取扩展公钥，推导子地址列表 | P1 |
| 10 | 交易记录提取 | FORESHADOW | 从 Ledger Live/Trezor 客户端内存中恢复交易历史 | P1 |
| 11 | 设备标识符关联 | FORESHADOW | 提取 USB 设备序列号，关联物理硬件钱包 | P1 |
| 12 | macOS 内存适配 | 自研 | FORESHADOW 仅支持 Windows，扩展至 macOS | P2 |

#### 阶段三：链上追溯与高级分析（8-12 周）

**目标：形成"设备取证 → 链上追溯 → 风险定性"的完整证据闭环**

| 序号 | 功能 | 来源借鉴 | 实现方案 | 优先级 |
|------|------|----------|----------|--------|
| 13 | 交易追溯可视化 | BlockSci 理念 | 调用 Blockchair/Etherscan API，展示交易上下游图谱 | P1 |
| 14 | 多链地址余额批量查询 | OSINT 资源 | 扩展 chainbalance 模块，支持 TRX/SOL/BSC | P1 |
| 15 | 已删除浏览历史恢复 | Autopsy | SQLite WAL 文件解析，恢复已清除的浏览记录 | P1 |
| 16 | 地址聚类分析 | BlockSci | 基于启发式算法归属多个地址到同一实体 | P2 |
| 17 | 全盘关键词搜索 | Autopsy | 对指定目录做助记词/私钥/种子词的正则搜索 | P2 |
| 18 | 磁盘镜像导入 | Autopsy/TSK | 支持 E01/dd 格式，复用 TSK 库做文件系统解析 | P3 |

---

## 六、技术架构升级建议

### 现有架构

```
CLI / Desktop / Web UI
        ↓
  Service 编排层（hostscan / mobilescan / matcher）
        ↓
  Adapter 层（host/scanner, mobile/scanner, rules/loader, sqlite/store）
        ↓
  Domain Model
```

### 升级后的架构

```
CLI / Desktop / Web UI
        ↓
┌───────────────────────────────────────────────────┐
│              Service 编排层                         │
│  ┌──────────┐ ┌──────────┐ ┌───────────┐          │
│  │ hostscan │ │mobilescan│ │ memscan   │ ← 新增    │
│  └──────────┘ └──────────┘ └───────────┘          │
│  ┌──────────┐ ┌──────────┐ ┌───────────┐          │
│  │ matcher  │ │chainquery│ │risk_intel │ ← 新增    │
│  └──────────┘ └──────────┘ └───────────┘          │
│  ┌──────────┐ ┌──────────┐ ┌───────────┐          │
│  │forensicpdf│ │ zipexport│ │ timeline  │ ← 新增   │
│  └──────────┘ └──────────┘ └───────────┘          │
└───────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────┐
│              Adapter 层                            │
│  host/scanner (扩展: Cookie + 下载 + 搜索词)       │
│  mobile/scanner                                    │
│  memory/scanner ← 新增：YARA 扫描 + 数据提取       │
│  address/scanner ← 新增：多链地址正则全文搜索       │
│  rules/loader (扩展: 地址正则规则)                  │
│  intel/provider ← 新增：Chainabuse/Bitcoinabuse   │
│  chain/provider (扩展: TRX/SOL/BSC)               │
│  sqlite/store                                      │
└───────────────────────────────────────────────────┘
```

### 新增模块说明

| 模块 | 路径 | 职责 |
|------|------|------|
| `memory/scanner` | `internal/adapters/memory/scanner.go` | 加载内存转储，YARA 扫描，硬件钱包数据提取 |
| `address/scanner` | `internal/adapters/address/scanner.go` | 多链地址正则提取与校验 |
| `intel/provider` | `internal/adapters/intel/provider.go` | 风险情报 API 接入（Chainabuse 等） |
| `memscan` | `internal/services/memscan/service.go` | 内存取证流程编排 |
| `risk_intel` | `internal/services/riskintel/service.go` | 地址风险评估编排 |
| `timeline` | `internal/services/timeline/service.go` | 跨源时间线生成 |

---

## 七、竞争力分析总结

### 整合后 vs 现有开源工具

```
                高
                │
    整合后       │  ★ crypto-inspector (目标)
    crypto-     │     · 一键化操作
    inspector   │     · 设备取证 + 内存取证 + 链上追溯
                │     · 证据链完整
                │     · 风险情报
                │
                │
                │  Autopsy (通用取证标杆)
    易用性       │     · 功能全面但不聚焦数字币
                │     · 需要磁盘镜像
                │
                │
                │  FORESHADOW (内存取证)     BlockSci (链上分析)
                │     · 仅内存                 · 仅链上
                │     · 仅 Windows             · 已停止维护
                │     · 需手动操作              · 需自建节点
                │
    低          └──────────────────────────────────────────── 高
                              数字币取证专业度
```

### 差异化竞争壁垒

| 壁垒 | 竞品状况 | crypto-inspector 优势 |
|------|----------|----------------------|
| 一键化 | Autopsy 需要磁盘镜像制作、FORESHADOW 需手动 dump | **无需预处理，直接对活系统扫描** |
| 全链条 | 各工具只覆盖链条的一段 | **设备痕迹 → 地址提取 → 链上查询 → 风险定性 → 报告生成** |
| 证据链 | 多数工具无严格防篡改机制 | **SHA256 + chain_hash 全程不可篡改** |
| 多端 | FORESHADOW 仅 Windows；Autopsy 仅桌面 | **macOS + Windows + Android + iOS** |
| 出报告 | 多数工具只做分析不出报告 | **自动生成 JSON/PDF/ZIP 司法包** |

---

## 八、结论与建议

### 直接可用的项目

| 项目 | 建议 |
|------|------|
| **FORESHADOW** | ⭐⭐⭐⭐⭐ **核心参考**：借鉴 YARA 签名思路，用 Go 重新实现硬件钱包内存扫描 |
| **Autopsy** | ⭐⭐⭐⭐⭐ **设计标杆**：学习其浏览器取证深度（Cookie/下载/搜索词）和 UI 设计 |
| **awesome OSINT** | ⭐⭐⭐⭐ **资源整合**：直接接入其中列出的 API 数据源和风险数据库 |
| **BlockSci** | ⭐⭐ **理念参考**：不直接使用代码（已停维），但借鉴链上追溯的分析思路 |
| **DFF** | ⭐ **参考架构**：模块化设计理念有参考价值，代码不建议使用 |

### 一句话总结

> **crypto-inspector 已具备扎实的后端基础（9,328 行 Go 代码），现阶段最大的提升空间在于"取证深度"而非"取证广度"。通过整合 FORESHADOW 的内存取证能力、Autopsy 的浏览器深度分析、以及 OSINT 资源的风险情报，可以在 3 个月内打造出全球范围内首个"一站式数字货币取证平台"——这是目前任何单一开源工具都无法提供的。**
